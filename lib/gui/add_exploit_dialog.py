# -*- coding: utf-8 -*-

import wx
import wx.xrc
from data.exploits import *

try:
    from custom import custom_exploits
    custom_exploits_loaded = True
except ImportError:
    custom_exploits_loaded = False


###########################################################################
## Class AddExploitDialog
###########################################################################

class AddExploitDialog(wx.Dialog):
    def __init__(self, parent, career_index=None, title=u"Add Exploit"):
        wx.Dialog.__init__(self, parent, id=wx.ID_ANY, title=title, pos=wx.DefaultPosition,
                           size=wx.Size(765, 372), style=wx.DEFAULT_DIALOG_STYLE)

        self.SetSizeHints(wx.DefaultSize, wx.DefaultSize)

        bs_aed_main = wx.BoxSizer(wx.VERTICAL)

        self.p_aed_edit_exploits = wx.Panel(self, wx.ID_ANY, wx.DefaultPosition, wx.DefaultSize, wx.TAB_TRAVERSAL)
        bs_aed_1 = wx.BoxSizer(wx.VERTICAL)

        bs_aed_exploit_desc = wx.BoxSizer(wx.HORIZONTAL)

        sbs_aed_exploits = wx.StaticBoxSizer(wx.StaticBox(self.p_aed_edit_exploits, wx.ID_ANY, u"Exploits"),
                                             wx.HORIZONTAL)

        bs_aed_rb = wx.BoxSizer(wx.VERTICAL)

        self.rb_aed_universal = wx.RadioButton(sbs_aed_exploits.GetStaticBox(), wx.ID_ANY, u"Universal",
                                               wx.DefaultPosition, wx.DefaultSize, wx.RB_GROUP)
        bs_aed_rb.Add(self.rb_aed_universal, 0, wx.ALL, 5)

        self.rb_aed_career = wx.RadioButton(sbs_aed_exploits.GetStaticBox(), wx.ID_ANY, u"Career", wx.DefaultPosition,
                                            wx.DefaultSize, 0)
        bs_aed_rb.Add(self.rb_aed_career, 0, wx.ALL, 5)

        self.rb_aed_android = wx.RadioButton(sbs_aed_exploits.GetStaticBox(), wx.ID_ANY, u"Android", wx.DefaultPosition,
                                             wx.DefaultSize, 0)
        bs_aed_rb.Add(self.rb_aed_android, 0, wx.ALL, 5)

        self.rb_aed_custom = wx.RadioButton(sbs_aed_exploits.GetStaticBox(), wx.ID_ANY, u"Custom", wx.DefaultPosition,
                                            wx.DefaultSize, 0)
        bs_aed_rb.Add(self.rb_aed_custom, 0, wx.ALL, 5)

        sbs_aed_exploits.Add(bs_aed_rb, 0, wx.EXPAND, 5)

        bs_aed_exploits_list_and_rb = wx.BoxSizer(wx.HORIZONTAL)

        lb_aed_exploit_listChoices = []
        self.lb_aed_exploit_list = wx.ListBox(sbs_aed_exploits.GetStaticBox(), wx.ID_ANY, wx.DefaultPosition,
                                              wx.DefaultSize, lb_aed_exploit_listChoices, 0)
        self.lb_aed_exploit_list.SetMinSize(wx.Size(-1, 120))

        bs_aed_exploits_list_and_rb.Add(self.lb_aed_exploit_list, 0, wx.ALL, 5)

        sbs_aed_exploits.Add(bs_aed_exploits_list_and_rb, 0, wx.EXPAND, 5)

        bs_aed_exploit_desc.Add(sbs_aed_exploits, 0, wx.EXPAND, 5)

        sbs_aed_exploit_desc = wx.StaticBoxSizer(wx.StaticBox(self.p_aed_edit_exploits, wx.ID_ANY, u"Description"),
                                                 wx.VERTICAL)

        self.tc_aed_exploit_desc = wx.TextCtrl(sbs_aed_exploit_desc.GetStaticBox(), wx.ID_ANY, wx.EmptyString,
                                               wx.DefaultPosition, wx.DefaultSize, wx.TE_MULTILINE | wx.TE_READONLY)
        self.tc_aed_exploit_desc.SetMinSize(wx.Size(-1, 140))

        sbs_aed_exploit_desc.Add(self.tc_aed_exploit_desc, 0, wx.ALL | wx.EXPAND, 5)

        bs_aed_exploit_desc.Add(sbs_aed_exploit_desc, 2, wx.EXPAND, 5)

        bs_aed_1.Add(bs_aed_exploit_desc, 1, wx.EXPAND, 5)

        sbs_aed_current_stats = wx.StaticBoxSizer(
            wx.StaticBox(self.p_aed_edit_exploits, wx.ID_ANY, u"Current Career Track Stats"), wx.VERTICAL)

        gs_aed_current_stats_1 = wx.GridSizer(0, 12, 0, 0)

        self.st_aed_str = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"STR", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_str.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_str, 0, wx.ALL, 5)

        self.st_aed_agi = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"AGI", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_agi.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_agi, 0, wx.ALL, 5)

        self.st_aed_end = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"END", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_end.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_end, 0, wx.ALL, 5)

        self.st_aed_int = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"INT", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_int.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_int, 0, wx.ALL, 5)

        self.st_aed_log = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"LOG", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_log.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_log, 0, wx.ALL, 5)

        self.st_aed_wil = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"WIL", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_wil.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_wil, 0, wx.ALL, 5)

        self.st_aed_cha = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"CHA", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_cha.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_cha, 0, wx.ALL, 5)

        self.st_aed_luc = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"LUC", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_luc.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_luc, 0, wx.ALL, 5)

        self.st_aed_rep = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"REP", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_rep.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_rep, 0, wx.ALL, 5)

        self.st_aed_mag = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"MAG", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_mag.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_mag, 0, wx.ALL, 5)

        self.st_aed_chi = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"CHI", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_chi.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_chi, 0, wx.ALL, 5)

        self.st_aed_psi = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"PSI", wx.DefaultPosition,
                                        wx.DefaultSize, 0)
        self.st_aed_psi.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_psi, 0, wx.ALL, 5)

        self.st_aed_str_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"str_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_str_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_str_val, 0, wx.ALL, 5)

        self.st_aed_agi_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"agi_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_agi_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_agi_val, 0, wx.ALL, 5)

        self.st_aed_end_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"end_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_end_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_end_val, 0, wx.ALL, 5)

        self.st_aed_int_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"int_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_int_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_int_val, 0, wx.ALL, 5)

        self.st_aed_log_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"log_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_log_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_log_val, 0, wx.ALL, 5)

        self.st_aed_wil_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"wil_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_wil_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_wil_val, 0, wx.ALL, 5)

        self.st_aed_cha_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"cha_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_cha_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_cha_val, 0, wx.ALL, 5)

        self.st_aed_luc_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"luc_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_luc_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_luc_val, 0, wx.ALL, 5)

        self.st_aed_rep_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"rep_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_rep_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_rep_val, 0, wx.ALL, 5)

        self.st_aed_mag_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"mag_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_mag_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_mag_val, 0, wx.ALL, 5)

        self.st_aed_chi_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"chi_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_chi_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_chi_val, 0, wx.ALL, 5)

        self.st_aed_psi_val = wx.StaticText(sbs_aed_current_stats.GetStaticBox(), wx.ID_ANY, u"psi_val",
                                            wx.DefaultPosition, wx.DefaultSize, 0)
        self.st_aed_psi_val.Wrap(-1)
        gs_aed_current_stats_1.Add(self.st_aed_psi_val, 0, wx.ALL, 5)

        sbs_aed_current_stats.Add(gs_aed_current_stats_1, 1, wx.EXPAND, 5)

        bs_aed_1.Add(sbs_aed_current_stats, 1, wx.EXPAND, 5)

        bs_aed_buttons = wx.BoxSizer(wx.HORIZONTAL)

        self.b_aed_ok = wx.Button(self.p_aed_edit_exploits, wx.ID_ANY, u"OK", wx.DefaultPosition, wx.DefaultSize, 0)
        bs_aed_buttons.Add(self.b_aed_ok, 0, wx.ALL, 5)

        self.b_aed_cancel = wx.Button(self.p_aed_edit_exploits, wx.ID_ANY, u"Cancel", wx.DefaultPosition,
                                      wx.DefaultSize, 0)
        bs_aed_buttons.Add(self.b_aed_cancel, 0, wx.ALL, 5)

        bs_aed_1.Add(bs_aed_buttons, 0, wx.ALIGN_RIGHT, 5)

        self.p_aed_edit_exploits.SetSizer(bs_aed_1)
        self.p_aed_edit_exploits.Layout()
        bs_aed_1.Fit(self.p_aed_edit_exploits)
        bs_aed_main.Add(self.p_aed_edit_exploits, 1, wx.EXPAND | wx.ALL, 5)

        self.SetSizer(bs_aed_main)
        self.Layout()

        self.Centre(wx.BOTH)

        # Connect Events
        self.rb_aed_universal.Bind(wx.EVT_RADIOBUTTON, self.show_exploits)
        self.rb_aed_career.Bind(wx.EVT_RADIOBUTTON, self.show_exploits)
        self.rb_aed_android.Bind(wx.EVT_RADIOBUTTON, self.show_exploits)
        self.rb_aed_custom.Bind(wx.EVT_RADIOBUTTON, self.show_exploits)
        self.lb_aed_exploit_list.Bind(wx.EVT_LISTBOX, self.on_exploit_select)
        self.b_aed_ok.Bind(wx.EVT_BUTTON, self.on_ok)
        self.b_aed_cancel.Bind(wx.EVT_BUTTON, self.on_cancel)

        if career_index is not None:
            self.current_career = parent.user_character.career_track[career_index]['Career']
            self.current_stats = parent.user_character.calc_current_stat_total(career_index)
        else:
            self.rb_aed_career.Enable(False)
            self.rb_aed_career.Hide()
            self.current_stats = parent.user_character.calc_stat_total()
            sbs_aed_current_stats.GetStaticBox().SetLabel('Total Stats')
            sbs_aed_current_stats.Layout()

        self.st_aed_str_val.SetLabel(str(self.current_stats['STR']))
        self.st_aed_agi_val.SetLabel(str(self.current_stats['AGI']))
        self.st_aed_end_val.SetLabel(str(self.current_stats['END']))
        self.st_aed_int_val.SetLabel(str(self.current_stats['INT']))
        self.st_aed_log_val.SetLabel(str(self.current_stats['LOG']))
        self.st_aed_wil_val.SetLabel(str(self.current_stats['WIL']))
        self.st_aed_cha_val.SetLabel(str(self.current_stats['CHA']))
        self.st_aed_luc_val.SetLabel(str(self.current_stats['LUC']))
        self.st_aed_rep_val.SetLabel(str(self.current_stats['REP']))
        self.st_aed_mag_val.SetLabel(str(self.current_stats['MAG']))
        self.st_aed_chi_val.SetLabel(str(self.current_stats['CHI']))
        self.st_aed_psi_val.SetLabel(str(self.current_stats['PSI']))

        if not custom_exploits_loaded:
            self.rb_aed_custom.Enable(False)
            self.rb_aed_custom.Hide()

        self.show_exploits(None)
        self.on_exploit_select(None)

    def __del__(self):
        pass

    ###########################################
    # Additional AddExploitsDialog init stuff #
    ###########################################
    # if career is None:
    #     self.rb_aed_career.Enable(False)
    #     self.rb_aed_career.Hide()
    # if not custom_exploits_loaded:
    #     self.rb_aed_custom.Enable(False)
    #     self.rb_aed_custom.Hide()
    #
    # self.show_exploits(None)
    # self.on_exploit_select(None)

    ###############################
    # AddExploitsDialog Functions #
    ###############################
    def get_exploit_list(self):
        if self.rb_aed_android.GetValue():
            exploit_list = exploits_android.exploit_android_list
        elif self.rb_aed_career.GetValue():
            exploit_list = self.current_career.available_exploits
        elif self.rb_aed_custom.GetValue():
            exploit_list = custom_exploits.custom_exploit_list
        else:
            exploit_list = exploits_universal.exploit_universal_list
        return exploit_list

    def get_list_source(self):
        list_source = None
        if self.rb_aed_universal.GetValue():
            list_source = 'universal'
        elif self.rb_aed_android.GetValue():
            list_source = 'android'
        elif self.rb_aed_career.GetValue():
            list_source = 'career'
        elif self.rb_aed_custom.GetValue():
            list_source = 'custom'
        return list_source

    def show_exploits(self, event):
        exploit_list = self.get_exploit_list()
        self.lb_aed_exploit_list.Clear()

        for exploit in exploit_list:
            self.lb_aed_exploit_list.Append(exploit['Name'])

        self.lb_aed_exploit_list.SetSelection(0)
        self.on_exploit_select(None)

    def on_exploit_select(self, event):
        exploit_list = self.get_exploit_list()
        selected_exploit = self.lb_aed_exploit_list.GetSelection()
        self.tc_aed_exploit_desc.SetValue(exploit_list[selected_exploit]['Desc'])

    def on_ok(self, event):
        self.EndModal(wx.ID_OK)

    def on_cancel(self, event):
        self.EndModal(wx.ID_CANCEL)